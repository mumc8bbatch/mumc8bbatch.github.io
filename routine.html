<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B Batch Routine (MuMC 08)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Highlight style for the current class */
      .highlight {
        background-color: #ffff99; /* light yellow */
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h1 class="text-center">Mugda Medical College</h1>
      <h2 class="text-center">
        3<sup>rd</sup> Year Routine <br />
        (B Batch - MuMC 08)
      </h2>
      <div class="mb-3 mt-3">
        <label for="daySelector" class="form-label">Select a Day:</label>
        <select id="daySelector" class="form-select" onchange="updateRoutine()">
          <option value="Saturday">Saturday</option>
          <option value="Sunday">Sunday</option>
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
        </select>
      </div>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title" id="selectedDay">Today's Routine</h5>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Time</th>
                <th>Subject</th>
              </tr>
            </thead>
            <tbody id="routineTable"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        setDefaultDay();
      });

      function setDefaultDay() {
        const days = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Saturday",
        ];
        let today = new Date().toLocaleString("en-us", { weekday: "long" });
        if (!days.includes(today)) {
          today = "Sunday";
        }
        document.getElementById("daySelector").value = today;
        updateRoutine();
      }

      // Helper function to parse a time string like "8:10 am" into a Date object for today.
      function parseTime(timeStr) {
        const [time, modifier] = timeStr.trim().toLowerCase().split(" ");
        let [hours, minutes] = time.split(":").map(Number);
        if (modifier === "pm" && hours !== 12) {
          hours += 12;
        }
        if (modifier === "am" && hours === 12) {
          hours = 0;
        }
        let now = new Date();
        now.setHours(hours, minutes, 0, 0);
        return now;
      }

      function updateRoutine() {
        const day = document.getElementById("daySelector").value;
        document.getElementById("selectedDay").innerText = `${day}'s Routine`;

        const routineData = {
          Saturday: [
            {
              time: "8:10 am - 10:00 am",
              subject: "Pharmacology",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 12:50 pm",
              subject: "Microbiology",
              type: "Lecture",
            },
            {
              time: "12:50 pm - 1:40 pm",
              subject: "Forensic Medicine",
              type: "Lecture",
            },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
          Sunday: [
            { time: "7:20 am - 8:10 am", subject: "Surgery", type: "Lecture" },
            {
              time: "8:10 am - 10:00 am",
              subject: "Pathology",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 12:50 pm",
              subject: "Forensic Medicine",
              type: "Lecture",
            },
            {
              time: "12:50 pm - 1:40 pm",
              subject: "Pharmacology",
              type: "Lecture",
            },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
          Monday: [
            {
              time: "1:10 am - 10:00 am",
              subject: "Forensic Medicine",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 12:50 pm",
              subject: "Pharmacology",
              type: "Lecture",
            },
            {
              time: "12:50 pm - 1:40 pm",
              subject: "Pathology",
              type: "Lecture",
            },
            { time: "1:40 pm - 2:30 pm", subject: "Medicine", type: "Lecture" },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
          Tuesday: [
            {
              time: "8:10 am - 10:00 am",
              subject: "Pharmacology",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 1:40 pm",
              subject: "Integrated Teaching",
              type: "Lecture",
            },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
          Wednesday: [
            {
              time: "8:10 am - 10:00 am",
              subject: "Microbiology",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 12:50 pm",
              subject: "Pharmacology",
              type: "Lecture",
            },
            {
              time: "12:50 pm - 1:40 pm",
              subject: "Forensic Medicine",
              type: "Lecture",
            },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
          Thursday: [
            {
              time: "8:10 am - 10:00 am",
              subject: "Forensic Medicine",
              type: "Tutorial",
            },
            {
              time: "10:20 am - 12:00 pm",
              subject: "Surgery",
              type: "Morning Ward",
            },
            {
              time: "12:00 pm - 12:50 pm",
              subject: "Forensic Medicine",
              type: "Lecture",
            },
            {
              time: "12:50 pm - 1:40 pm",
              subject: "Pharmacology",
              type: "Lecture",
            },
            {
              time: "7:00 pm - 9:00 pm",
              subject: "Surgery",
              type: "Evening Ward",
            },
          ],
        };

        const routineTable = document.getElementById("routineTable");
        routineTable.innerHTML = "";

        const now = new Date();
        const currentDay = new Date().toLocaleString("en-us", {
          weekday: "long",
        });
        const isToday = day === currentDay;

        routineData[day].forEach((item) => {
          let highlightClass = "";
          if (isToday) {
            // Split the time string into start and end times
            const times = item.time.split(" - ");
            if (times.length === 2) {
              const startTime = parseTime(times[0]);
              const endTime = parseTime(times[1]);
              console.log(
                `Now: ${now.toLocaleTimeString()}, Start: ${startTime.toLocaleTimeString()}, End: ${endTime.toLocaleTimeString()}`
              );
              if (now >= startTime && now < endTime) {
                highlightClass = " highlight";
                console.log(`Highlighting ${item.subject}`);
              }
            }
          }

          const badgeClass =
            {
              Tutorial: "badge bg-primary",
              Lecture: "badge bg-success",
              "Morning Ward": "badge bg-warning text-dark",
              "Evening Ward": "badge bg-warning text-dark",
            }[item.type] || "";

          const formattedSubject = item.type
            ? `${item.subject} <span class="${badgeClass}">${item.type}</span>`
            : item.subject;

          routineTable.innerHTML += `<tr class="routine-row${highlightClass}">
                        <td>${item.time}</td>
                        <td>${formattedSubject}</td>
                     </tr>`;
        });
      }
    </script>
  </body>
</html>
